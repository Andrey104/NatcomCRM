<div *ngIf="loadPage" class="spinner-page">
  <app-preloader></app-preloader>
</div>
<div *ngIf="!loadPage" class="mainDiv col s12 detail-col scrollable-page" id="page">
  <div class="col s12 detail-col valign-wrapper left-align">
    <div routerLink="{{backRouter}}"
         class="col s2 row-back valign-wrapper hover-element no-border">
      <i class="small material-icons no-border icon-arrow-back">
        keyboard_arrow_left
      </i>
      <span class="back icon-arrow-back">Назад</span>
    </div>
    <div class="col s4 valign-wrapper">
      <img class="avatar" src="{{mount?.user?.type | imageType}}">
      <div>{{mount?.user?.first_name}} {{mount?.user?.last_name}}</div>
    </div>

    <div class="col s8">{{mount?.status | mountStatus}}</div>
    <div class="col s1 namePage">Монтаж</div>
  </div>
  <div class="col s12 divider detail-col"></div>
  <div class="col s12 valign-wrapper">
    <div class="status-container valign-wrapper main-info">
      <div [appColorCompany]="mount?.company?.symbol" class="company-symbol">{{mount?.company?.symbol}}</div>
      <div class="company-name">{{mount?.company?.name}}</div>
    </div>
  </div>
  <div class="mount-info">
    <div class="col s12 str-info">
      <i
        class="tiny  material-icons  icon">date_range</i>
      <span *ngIf="mount.date">  {{mount?.date | dateFormat: 'date'}}</span>
      <span *ngIf="!mount.date">По звонку</span>
    </div>
    <div class="col s12 str-info">
      <i class="tiny  material-icons icon">assignment</i><span> Номер договора:  {{dealId | dealContractView}}</span>
    </div>
    <div class="col s12 str-info" *ngIf="mount.description">
      <i
        class="tiny  material-icons  icon">comment</i>
      <span> {{mount?.description}}</span>
    </div>
  </div>
  <div class="col s12 row valign-wrapper detail-col">
    <div class="col s5 divider "></div>
    <div class="col s2 center-align">Cтадии</div>
    <div class="col s5 divider "></div>
  </div>
  <div class="col s12 main-row valign-wrapper forward-block hover-element" routerLink="stage/{{stage?.id}}"
       *ngFor="let stage of mount?.stages; let i = index">
    <div *ngIf="i!==0">
      <div class="row">
        <div class="divider"></div>
      </div>
    </div>
    <app-stage-deal [stage]="stage" class="col s11"></app-stage-deal>
    <i class="arrow col s1 material-icons right-align">chevron_right</i>
  </div>
  <div class="col s12 row valign-wrapper detail-col">
    <div class="col s5 divider "></div>
    <div class="col s2 center-align">История</div>
    <div class="col s5 divider "></div>
  </div>
  <div *ngFor="let action of mount?.actions" class="col s10 offset-s1 action">
    <div>{{action.auto_date | dateFormat: 'fullDate'}} {{action | action: 'mount'}}</div>
  </div>
  <div class="col s12 row valign-wrapper detail-col">
    <div class="col s5 divider"></div>
    <div class="col s2 center-align header">Комментарии</div>
    <div class="col s5 divider"></div>
  </div>
  <div class="row">
    <div *ngFor="let comment of mount?.comments" class="col s12">
      <app-deal-comments [comment]="comment"></app-deal-comments>
    </div>
  </div>

  <div class="fixed-action-btn click-to-toggle"
       *ngIf="!(mount.status==2 || mount.status==3)&&showEditButtons">
    <a class="btn-floating btn-large orange" id="main-btn">
      <i class="large material-icons color-fab-icon">menu</i>
    </a>
    <ul class="fab-ul">
      <li class="hover-element li-element-menu-fab" (click)="showRejectMount = !showRejectMount"
          onclick="$('#main-btn').click()">
        <div class="center-align valign-wrapper menu-li-div"><span class="fab-text">Отклонить монтаж</span>
          <div class="icon-fab center-align valign-wrapper"><i class="material-icons color-fab-icon">close</i></div>
        </div>
      </li>
      <li class="hover-element li-element-menu-fab" (click)="showMountStageAdd = !showMountStageAdd"
          onclick="$('#main-btn').click()">
        <div class="center-align valign-wrapper menu-li-div"><span class="fab-text">Добавить стадию</span>
          <div class="icon-fab center-align valign-wrapper"><i class="material-icons color-fab-icon">add</i></div>
        </div>
      </li>
      <li class="hover-element li-element-menu-fab" (click)="showTransferMount = !showTransferMount"
          onclick="$('#main-btn').click()">
        <div class="center-align valign-wrapper menu-li-div"><span class="fab-text">Перенести монтаж</span>
          <div class="icon-fab center-align valign-wrapper"><i class="material-icons color-fab-icon">event</i></div>
        </div>
      </li>
      <li class="hover-element li-element-menu-fab" (click)="showCompleteMount = !showCompleteMount"
          onclick="$('#main-btn').click()">
        <div class="center-align valign-wrapper menu-li-div"><span class="fab-text">Завершить монтаж</span>
          <div class="icon-fab center-align valign-wrapper"><i class="material-icons color-fab-icon">check</i></div>
        </div>
      </li>
    </ul>
  </div>
</div>
<div *ngIf="!loadPage" class="col s12 mount-comment-content valign-wrapper">
  <app-comment class="comment-content" (comment)="sendComment($event)"></app-comment>
</div>
<app-mount-dialog-reject [mount]="mount" (successMountReject)="successMountUpdate()"
                         [(visible)]="showRejectMount"></app-mount-dialog-reject>
<app-mount-dialog-complete [mount]="mount" (successMountComplete)="successMountUpdate()"
                           [(visible)]="showCompleteMount"></app-mount-dialog-complete>
<app-mount-dialog-transfer [mount]="mount" (successMountTransfer)="successMountUpdate()"
                           [(visible)]="showTransferMount"></app-mount-dialog-transfer>
<app-mount-dialog-add-stage [mount]="mount" (successMountStageAdd)="successMountUpdate()"
                            [(visible)]="showMountStageAdd"></app-mount-dialog-add-stage>
